<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <!-- import CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="./index_css.css" type="text/css">
</head>

<body>
    <div id="app">
        <div class="titlebar">
            <p class="titlebar_p">各种操作</P>
        </div>
        <el-collapse>
            <el-collapse-item title="A：获取图谱科技Token" name="1">
                <el-form ref="form" v-model="gettokenform" label-width="120px" inline>
                    <el-form-item label="图谱Key">
                        <el-input v-model="gettokenform.key" size="mini" placeholder="请输入Key值，注意保密" style="width:200px"></el-input>
                    </el-form-item>
                    <el-form-item label="图谱screct">
                        <el-input v-model="gettokenform.screct" size="mini" placeholder="请输入screct值，注意保密" style="width:200px"></el-input>
                    </el-form-item>
                    <el-form-item>
                        <el-button type="primary" v-on:click="gettoken()" size="mini">获取Token值</el-button>
                    </el-form-item>
                    <el-form-item label="返回的Token值">
                        <el-input v-model="token" readonly size="mini" style="width:650px"></el-input>
                    </el-form-item>
                </el-form>
            </el-collapse-item>
            <el-collapse-item title="B：获得客户流数据" name="2">
                <el-form ref="form" v-mode="getvisitorsform" labed-width="120px" inline>
                    <el-row>
                        <el-form-item label="访客分类">
                            <el-select v-model="getvisitorsform.tag.value" placeholder="请选择" size="mini">
                                <el-option v-for="item in getvisitorsform.tag.options" :key="item.value" :label="item.label" :value="item.value">
                                </el-option>
                            </el-select>
                        </el-form-item>
                        <el-form-item label="排序方式">
                            <el-select v-model="getvisitorsform.sortBy.value" placeholder="请选择" size="mini">
                                <el-option v-for="item in getvisitorsform.sortBy.options" :key="item.value" :label="item.label" :value="item.value">
                                </el-option>
                            </el-select>
                        </el-form-item>
                        <el-form-item label="升降序选择">

                            <el-select v-model="getvisitorsform.sortOrder.value" placeholder="请选择" size="mini">
                                <el-option v-for="item in getvisitorsform.sortOrder.options" :key="item.value" :label="item.label" :value="item.value">
                                </el-option>
                            </el-select>

                        </el-form-item>
                    </el-row>
                    <el-row>
                        <el-form-item label="查询日期">
                            <el-date-picker v-model="getvisitorsform.date" type="date" placeholder="选择日期" size="mini">
                            </el-date-picker>
                        </el-form-item>
                        <el-form-item label="Start">
                            <el-date-picker v-model="getvisitorsform.start" type="date" placeholder="start与end必须同时设置" size="mini">
                            </el-date-picker>
                        </el-form-item>
                        <el-form-item label="End">
                            <el-date-picker v-model="getvisitorsform.end" type="date" placeholder="start与end必须同时设置" size="mini">
                            </el-date-picker>
                        </el-form-item>
                    </el-row>
                    <el-row>
                        <el-form-item>
                            <el-button type="primary" v-on:click="getvisitors()" size="mini">获取</el-button>
                        </el-form-item>
                    </el-row>
                </el-form>
            </el-collapse-item>
        </el-collapse>
    </div>
</body>
<!-- import Vue before Element -->
<!-- <script src="https://unpkg.com/vue/dist/vue.js"></script> -->
<script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"></script>
<!-- import JavaScript -->
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue-resource@1.5.1"></script>
<script src="fun.js"></script>
<script>
    vm = new Vue({
        el: '#app',
        data: function() {
            return {
                getkeyurl: "http://www.dcrm.com/src/gettoken.php",
                gettokenform: {
                    key: 'tgr3cu3q1r63ib85k7lbrcchp1vu1elolbpbqrgl',
                    screct: '9ld2fq1g2n3pt1sat4cts7060nkndaisql9fjoo7'
                },
                token: null,
                UID: '5a697361400b0115d512a553',
                SID: '5a697383400b0115d512a555',
                getvisitorsurl: "http://www.dcrm.com/src/getvisitors.php",
                getvisitorsform: {
                    tag: {
                        options: [{
                            value: "staff",
                            label: "员工"
                        }, {
                            value: "customer",
                            label: "普通顾客"
                        }, {
                            value: "VIP",
                            label: "VIP"
                        }, {
                            value: "allCustomer",
                            label: "普通客户+注册客户"
                        }, {
                            value: "regularCustomer",
                            label: "回头客"
                        }, {
                            value: "newCustomer",
                            label: "新顾客"
                        }],
                        value: ""
                    },
                    sortBy: {
                        options: [{
                            value: "",
                            label: "无排序"
                        }, {
                            value: "firstEnterTime",
                            label: "第一次进入时间"
                        }, {
                            value: "start",
                            label: "进入时间"
                        }, {
                            value: "lastCaputuredTime",
                            label: "最新拍摄到的时间"
                        }, {
                            value: "end",
                            label: "最近出现时间"
                        }, {
                            value: "visitDuration",
                            label: "来访时间"
                        }, {
                            value: "duration",
                            label: "停留时间"
                        }, {
                            value: "visitCount",
                            label: "来访次数"
                        }, {
                            value: "visitCountOfDay",
                            label: "来访天数"
                        }, {
                            value: "historyVisitCount",
                            label: "历史来访次数"
                        }, {
                            value: "visitSum",
                            label: "历史总来访次数"
                        }, {
                            value: "historyDailyVisitCount",
                            label: "历史日来访次数"
                        }, {
                            value: "visitDays",
                            label: "历史来访天数"
                        }],
                        value: ""
                    },
                    sortOrder: {
                        options: [{
                            value: "desc",
                            label: "降序"
                        }, {
                            value: "asc",
                            label: "升序"
                        }],
                        value: ""
                    },
                    date: "",
                    start: "",
                    end: ""
                }
            }
        },
        methods: {
            gettoken: function() {
                this.$http.post(this.getkeyurl, this.gettokenform, {
                    emulateJSON: true
                }).then(function(res) {
                    console.log(res.data);
                    this.token = res.data.token;
                }, function(res) {
                    console.log(res.status)
                })
            },
            getvisitors: function() {
                obj = this.getvisitorsform;
                bodyobj = new Object();
                bodyobj.tag = obj.tag.value;
                bodyobj.sortBy = obj.sortBy.value;
                bodyobj.sortOrder = obj.sortOrder.value;

                if (obj.date != "") {
                    bodyobj.date = obj.date.getFullYear() + "-" + month2normal(obj.date.getMonth()) + "-" + obj.date.getDate();
                } else {
                    bodyobj.date = "";
                }
                if (obj.start != "") {
                    bodyobj.start = obj.start.getFullYear() + "-" + month2normal(obj.start.getMonth()) + "-" + obj.start.getDate();
                } else {
                    bodyobj.start = "";
                }
                if (obj.end != "") {
                    bodyobj.end = obj.end.getFullYear() + "-" + month2normal(obj.end.getMonth()) + "-" + obj.end.getDate();
                } else {
                    bodyobj.end = "";
                }

                bodyobj.token = this.token;
                bodyobj.UID = this.UID;
                bodyobj.SID = this.SID;
                bodyobj.token = this.token;


                //console.log(bodyobj.date);

                this.$http.post(this.getvisitorsurl, bodyobj, {
                    emulateJSON: true
                }).then(function(res) {
                    console.log(res.data);
                    //this.token = res.data;
                }, function(res) {
                    console.log(res.status)
                })
            }
        }
    })
</script>

</html>